var y=Object.defineProperty;var g=(t,e,s)=>e in t?y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var f=(t,e,s)=>(g(t,typeof e!="symbol"?e+"":e,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();const w="192.168.2.2",r={getSystemInfo:async()=>{const{data:t}=await l({path:"/info/system"});return t||{}},saveName:async t=>{const{status:e}=await l({path:"/info/system",method:"PUT",payload:{name:t}});return e!==200},getActions:async()=>{const{data:t}=await l({path:"/info/actions"});return t||[]},performAction:async t=>{const{status:e}=await l({method:"PUT",path:"/actions",params:{action:t}});return e===200},getSensors:async()=>{const{data:t}=await l({path:"/sensors"});return t||{}},getStates:async()=>{const{data:t}=await l({path:"/states"});return t||{}},getConfigInfo:async()=>{const{data:t}=await l({path:"/info/config"});return t||{}},getConfigValues:async()=>{const{data:t}=await l({path:"/config"});return t||{}},deleteAllConfigValues:async()=>{const{status:t}=await l({method:"DELETE",path:"/config/delete/all"});return t===200},saveConfigValues:async t=>{const{status:e}=await l({method:"POST",path:"/config",payload:t});return e===200},getMetrics:async()=>{const{data:t}=await l({path:"/metrics"});return t||{}}};function C(t){if(!t||!Object.keys(t))return"";const e=Object.entries(t).map(([s,i])=>`${s}=${i}`);return e.length>0?"?"+e.join("&"):""}function l({method:t="GET",path:e,payload:s,params:i}){let n=new XMLHttpRequest;n.open(t,`http://${w}${e[0]!="/"?"/":""}${e}${C(i)}`),n.setRequestHeader("Accept","application/json"),s&&n.setRequestHeader("Content-Type","application/json");let a;const c=new Promise(d=>a=d);return n.onreadystatechange=()=>{n.readyState===4&&a({data:n.response?JSON.parse(n.response):null,status:n.status})},n.send(s?JSON.stringify(s):null),c}const h=({name:t,type:e})=>{const s=document.createElement("div");return s.innerHTML=`Not done yet :( ([${e}]${t})`,s},o={list:()=>{const t=document.createElement("div");return t.classList.add("list"),t},button:({id:t,label:e,onClick:s=()=>{},labelElement:i="h3",danger:n=!1})=>{const a=document.createElement("button");return t&&(a.id=t),a.innerHTML=`<${i}>${e}</${i}>`,a.onclick=s,n&&(a.style.backgroundColor="var(--color-danger)"),a},input:({id:t,label:e,value:s,disabled:i=!1,type:n="text",slot:a})=>{const c=document.createElement("div");c.classList.add("legit","field-container");const d=document.createElement("h2");d.classList.add("field-label"),d.innerHTML=e;const p=document.createElement("div");p.classList.add("input-with-slot");const u=document.createElement("input");return t&&(u.id=t),u.disabled=i,u.value=s,u.type=n,p.appendChild(u),a&&p.appendChild(a),c.append(d,p),c},tree:t=>{const e=document.createElement("ul");return Object.entries(t).forEach(([s,i])=>e.appendChild(v({key:s,value:i}))),e}},v=({key:t,value:e})=>{const s=document.createElement("li");return s.append(t+": ",E(e)),s},E=t=>{if(Array.isArray(t)){const e=document.createElement("ul");return t.forEach(s=>{const i=document.createElement("li");i.innerHTML=s,e.appendChild(i)}),e}else if(t instanceof Object){const e=document.createElement("ul");return Object.entries(t).forEach(([s,i])=>{const n=document.createElement("li");n.appendChild(v({key:s,value:i})),e.appendChild(n)}),e}else{const e=document.createElement("span");return e.innerHTML=t,e}};class m{constructor(e,s){f(this,"selectedTab",{});this.id=e,this.tabs=s}create(){const e=document.createElement("div");return e.classList.add("tabs-panel"),this.viewDiv=document.createElement("div"),this.viewDiv.classList.add("tabs-items","list"),this.viewDiv.id=this.id,Object.entries(this.tabs).forEach(([s,{name:i}])=>{const n=document.createElement("h2");n.id=s,n.innerHTML=i,n.onclick=()=>this.open(s),this.viewDiv.appendChild(n)}),this.contentDiv=document.createElement("div"),this.contentDiv.classList.add("tabs-content"),this.contentDiv.id=this.id+"_content",e.append(this.viewDiv,this.contentDiv),e}open(e){const s=document.getElementById(e);if(!s){console.error("Failed to open tab id="+e+": element not found");return}this.selectedTab.tab&&(this.selectedTab.tab.classList.remove("selected-tab"),this.selectedTab.content.style.display="None");let i=document.getElementById(e+"_content");i||(i=this.createTabContent(e),this.contentDiv.appendChild(i)),s.classList.add("selected-tab"),i.style.display="",this.selectedTab.tab=s,this.selectedTab.content=i}createTabContent(e){const s=e+"_content",i=document.createElement("div");if(i.id=s,i.classList.add("tab-content"),i.style.display="None",this.tabs[e].title){const n=document.createElement("h1");n.classList.add("title"),n.innerHTML=this.tabs[e].title,i.appendChild(n)}return this.loadContent(i,e),i}async loadContent(e,s){try{e.appendChild(await this.tabs[s].content())}catch(i){console.error(i)}}}const L={info:{name:"Information",title:"Device information",content:async()=>{const t=await r.getSystemInfo(),e=o.list();return e.append(o.input({id:"name",label:"Device name",value:t.name||"",slot:o.button({label:"save",onClick:()=>r.saveName(document.getElementById("name").value)})}),o.input({label:"Device type",value:t.type,disabled:!0}),o.input({label:"Firmware version",value:t.version,disabled:!0,type:"number"}),o.input({label:"Chip model",value:t.chip_model,disabled:!0}),o.input({label:"Chip revision",value:t.chip_revision,disabled:!0})),e}},actions:{name:"Actions",title:"Device actions",content:async()=>{const t=await r.getActions(),e=o.list();return Object.entries(t).forEach(([s,i])=>{e.appendChild(o.button({id:"action_"+s,label:i,labelElement:"h1",onClick:()=>r.performAction(s)}))}),e}},sensors:{name:"Sensors",title:"Sensors values",content:async()=>{const t=await r.getSensors(),e=Object.entries(t).reduce((i,[n,{value:a,type:c}])=>(i[n]={name:`${n} (${c}): ${a}`,title:"Callbacks",content:()=>h({name:n,type:"sensor"})},i),{});return new m("sensors",e).create()}},states:{name:"States",title:"Device states",content:async()=>{const t=await r.getStates(),e=Object.entries(t).reduce((i,[n,a])=>(i[n]={name:`${n}: ${a}`,title:"Callbacks",content:()=>h({name:n,type:"state"})},i),{});return console.log(e),new m("states",e).create()}},configuration:{name:"Configuration",title:"Configuration",content:async()=>{const t=await r.getConfigInfo(),e=await r.getConfigValues(),s=o.list();Object.entries(t).forEach(([a,{caption:c,type:d}])=>{s.appendChild(o.input({id:a,label:c,type:d,value:e[a]||""}))});const i=document.createElement("div");i.classList.add("controls-holder"),i.append(o.button({label:"Delete all values",danger:!0,labelElement:"h2",onClick:()=>{confirm("Are you sure you want to delete all configuration values?")&&r.deleteAllConfigValues()}}),o.button({label:"Save",labelElement:"h2",onClick:()=>r.saveConfigValues()}));const n=document.createElement("div");return n.append(s,i),n}},metrics:{name:"Metrics",title:"Device metrics",content:async()=>{const t=await r.getMetrics();return o.tree(t)}}},b=new m("tabs-main",L);window.onload=()=>{document.getElementById("control-panel").appendChild(b.create()),b.open("info")};
